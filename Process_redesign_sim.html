<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adaptive Leadership Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            transition: margin-right 0.3s ease;
        }

        .container.panel-open {
            margin-right: 450px;
        }

        /* Introduction Screen */
        .intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .intro-screen.hidden {
            display: none;
        }

        .intro-content {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.5);
        }

        .intro-header {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            padding: 40px 40px 32px;
            border-radius: 16px 16px 0 0;
        }

        .intro-header h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .intro-header .subtitle {
            font-size: 18px;
            opacity: 0.9;
        }

        .intro-body {
            padding: 40px;
        }

        .role-card {
            background: #f0f9ff;
            border-left: 4px solid var(--primary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 32px;
        }

        .role-card h2 {
            font-size: 20px;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .role-card p {
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .role-card p:last-child {
            margin-bottom: 0;
        }

        .role-card strong {
            color: var(--primary);
        }

        .objectives-section {
            margin-bottom: 32px;
        }

        .objectives-section h3 {
            font-size: 18px;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .objective-item {
            display: flex;
            align-items: start;
            margin-bottom: 16px;
            padding: 16px;
            background: var(--bg-main);
            border-radius: 8px;
        }

        .objective-icon {
            font-size: 24px;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .objective-content h4 {
            font-size: 16px;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .objective-content p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .key-concepts {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 32px;
        }

        .key-concepts h3 {
            font-size: 16px;
            color: #92400e;
            margin-bottom: 12px;
        }

        .key-concepts ul {
            margin-left: 20px;
            color: #78350f;
        }

        .key-concepts li {
            font-size: 14px;
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .intro-footer {
            padding: 24px 40px;
            border-top: 1px solid var(--border);
            text-align: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
        }

        .btn-large {
            padding: 16px 48px;
            font-size: 18px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Header */
        .header {
            background: var(--bg-card);
            padding: 24px;
            margin-bottom: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .header .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .week-display {
            text-align: right;
        }

        .week-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
        }

        .week-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        /* Metric Cards */
        .metric-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .metric-label {
            font-size: 13px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .metric-change {
            font-size: 14px;
            font-weight: 600;
        }

        .metric-change.positive {
            color: var(--success);
        }

        .metric-change.negative {
            color: var(--danger);
        }

        /* Stakeholder Section */
        .stakeholder-section {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .stakeholder-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .stakeholder-card {
            padding: 16px;
            border-radius: 8px;
            border: 2px solid var(--border);
            background: #f8fafc;
        }

        .stakeholder-name {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .satisfaction-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .satisfaction-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .satisfaction-fill.high {
            background: var(--success);
        }

        .satisfaction-fill.medium {
            background: var(--warning);
        }

        .satisfaction-fill.low {
            background: var(--danger);
        }

        .stakeholder-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Chart Section */
        .chart-section {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Decision History */
        .history-section {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .history-item {
            padding: 16px;
            border-left: 4px solid var(--primary);
            background: #f8fafc;
            border-radius: 4px;
            margin-bottom: 12px;
        }

        .history-item.success {
            border-left-color: var(--success);
        }

        .history-item.warning {
            border-left-color: var(--warning);
        }

        .history-item.danger {
            border-left-color: var(--danger);
        }

        .history-week {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .history-problem {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .history-action {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .history-outcome {
            font-size: 13px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Side Panel */
        .side-panel {
            position: fixed;
            top: 0;
            right: -500px;
            width: 500px;
            height: 100vh;
            background: var(--bg-card);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
            transition: right 0.3s ease;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .side-panel.active {
            right: 0;
        }

        .panel-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-main);
        }

        .panel-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .panel-week {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .problem-statement {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 16px;
            border-radius: 4px;
            margin-bottom: 24px;
        }

        .problem-statement h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #92400e;
        }

        .problem-statement p {
            font-size: 14px;
            color: #78350f;
            line-height: 1.6;
        }

        .branching-notice {
            background: #fee2e2;
            border-left: 4px solid var(--danger);
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 13px;
            color: #991b1b;
        }

        .branching-notice.warning {
            background: #fef3c7;
            border-left-color: var(--warning);
            color: #92400e;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .option:hover:not(.disabled) {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .option.selected {
            border-color: var(--primary);
            background: #dbeafe;
        }

        .option.disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        .option.locked {
            background: #f1f5f9;
            border-color: #cbd5e1;
            opacity: 0.6;
        }

        .option-label {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .option.locked .option-label {
            color: var(--text-secondary);
        }

        .option-text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .option-locked-text {
            font-size: 12px;
            color: var(--danger);
            font-style: italic;
            margin-top: 4px;
        }

        .feedback-panel {
            background: #dbeafe;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            display: none;
        }

        .feedback-panel.active {
            display: block;
        }

        .feedback-panel.success {
            background: #d1fae5;
            border-color: var(--success);
        }

        .feedback-panel.warning {
            background: #fef3c7;
            border-color: var(--warning);
        }

        .feedback-panel.danger {
            background: #fee2e2;
            border-color: var(--danger);
        }

        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .feedback-content {
            font-size: 14px;
            line-height: 1.6;
        }

        .panel-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border);
            background: var(--bg-main);
        }

        /* Completion Modal */
        .completion-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .completion-modal.active {
            display: flex;
        }

        .completion-content {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.3);
        }

        .completion-header {
            padding: 32px 32px 24px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .completion-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .completion-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .completion-body {
            padding: 32px;
        }

        .performance-badge {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 24px;
        }

        .performance-badge.excellent {
            background: #d1fae5;
            color: #065f46;
        }

        .performance-badge.good {
            background: #dbeafe;
            color: #1e40af;
        }

        .performance-badge.needs-improvement {
            background: #fee2e2;
            color: #991b1b;
        }

        .metrics-summary {
            background: var(--bg-main);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .summary-value {
            font-weight: bold;
            color: var(--text-primary);
        }

        .key-insight {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 16px;
            border-radius: 4px;
            margin-bottom: 24px;
        }

        .key-insight h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #92400e;
        }

        .key-insight p {
            font-size: 14px;
            color: #78350f;
            line-height: 1.6;
        }

        .completion-footer {
            padding: 24px 32px;
            border-top: 1px solid var(--border);
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard,
            .stakeholder-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .week-display {
                text-align: center;
            }

            .side-panel {
                width: 100%;
                right: -100%;
            }

            .container.panel-open {
                margin-right: 0;
            }

            .intro-body {
                padding: 24px;
            }

            .intro-header {
                padding: 32px 24px 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Introduction Screen -->
    <div class="intro-screen" id="introScreen">
        <div class="intro-content">
            <div class="intro-header">
                <h1>Adaptive Leadership Simulation</h1>
                <p class="subtitle">Customer Service Process Improvement Challenge</p>
            </div>
            <div class="intro-body">
                <div class="role-card">
                    <h2>üéØ Your Role</h2>
                    <p>You are <strong>Alex Chen, Team Lead for Customer Service</strong> at a rapidly growing SaaS company. Your team handles 500+ support tickets weekly across email, phone, and chat.</p>
                    <p>Leadership has tasked you with improving the customer service pipeline. You'll need to work closely with:</p>
                    <p><strong>‚Ä¢ Tech Team</strong> ‚Äì They build the tools and systems you need<br>
                    <strong>‚Ä¢ Sales Team</strong> ‚Äì They promise response times that affect your workload<br>
                    <strong>‚Ä¢ Your Service Team</strong> ‚Äì 12 agents dealing with growing pressure</p>
                    <p>The challenge? Response times are up 45%, satisfaction is down 15 points, and everyone has different priorities.</p>
                </div>

                <div class="objectives-section">
                    <h3>Your Objectives Over 7 Weeks:</h3>
                    <div class="objective-item">
                        <div class="objective-icon">üîç</div>
                        <div class="objective-content">
                            <h4>Identify Root Causes</h4>
                            <p>Look beyond symptoms to find systemic process issues</p>
                        </div>
                    </div>
                    <div class="objective-item">
                        <div class="objective-icon">üßò</div>
                        <div class="objective-content">
                            <h4>Manage Under Pressure</h4>
                            <p>Make calm, strategic decisions when stakeholders are stressed</p>
                        </div>
                    </div>
                    <div class="objective-item">
                        <div class="objective-icon">ü§ù</div>
                        <div class="objective-content">
                            <h4>Balance Stakeholders</h4>
                            <p>Navigate competing needs from Tech, Sales, Leadership, and your team</p>
                        </div>
                    </div>
                </div>

                <div class="key-concepts">
                    <h3>üéì Adaptive Leadership Principles</h3>
                    <ul>
                        <li><strong>Technical vs. Adaptive Problems:</strong> Technical problems have clear solutions; adaptive problems require new learning and behavior change</li>
                        <li><strong>Get on the Balcony:</strong> Step back from the action to see patterns rather than reacting to pressure</li>
                        <li><strong>Regulate Distress:</strong> Keep pressure productive‚Äînot so low people stay comfortable, not so high they shut down</li>
                        <li><strong>Give the Work Back:</strong> Don't solve problems for people; help them develop capacity to solve problems themselves</li>
                    </ul>
                </div>
            </div>
            <div class="intro-footer">
                <button class="btn btn-primary btn-large" onclick="startSimulation()">Begin Simulation</button>
            </div>
        </div>
    </div>

    <div class="container" id="mainContainer">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>Customer Service Process Improvement</h1>
                <p class="subtitle">Team Lead Dashboard</p>
            </div>
            <div class="week-display">
                <div class="week-number" id="weekNumber">Week 1</div>
                <div class="week-label">Current Week</div>
            </div>
        </div>

        <!-- Key Metrics Dashboard -->
        <div class="dashboard">
            <div class="metric-card">
                <div class="metric-label">Response Time</div>
                <div class="metric-value" id="metricResponseTime">48hrs</div>
                <div class="metric-change negative" id="changeResponseTime">‚Üë 15hrs from baseline</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Customer Satisfaction</div>
                <div class="metric-value" id="metricSatisfaction">68%</div>
                <div class="metric-change negative" id="changeSatisfaction">‚Üì 15pts from baseline</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Resolution Rate</div>
                <div class="metric-value" id="metricResolution">52%</div>
                <div class="metric-change negative" id="changeResolution">‚Üì 15pts from baseline</div>
            </div>
        </div>

        <!-- Stakeholder Status -->
        <div class="stakeholder-section">
            <h2 class="section-title">Stakeholder Relationships</h2>
            <div class="stakeholder-grid">
                <div class="stakeholder-card">
                    <div class="stakeholder-name">Sales Team</div>
                    <div class="satisfaction-bar">
                        <div class="satisfaction-fill low" id="satSales" style="width: 45%"></div>
                    </div>
                    <div class="stakeholder-status" id="statusSales">45% - Angry about broken promises</div>
                </div>
                <div class="stakeholder-card">
                    <div class="stakeholder-name">Your Service Team</div>
                    <div class="satisfaction-bar">
                        <div class="satisfaction-fill medium" id="satTeam" style="width: 55%"></div>
                    </div>
                    <div class="stakeholder-status" id="statusTeam">55% - Burned out and defensive</div>
                </div>
                <div class="stakeholder-card">
                    <div class="stakeholder-name">Tech Team</div>
                    <div class="satisfaction-bar">
                        <div class="satisfaction-fill medium" id="satTech" style="width: 60%"></div>
                    </div>
                    <div class="stakeholder-status" id="statusTech">60% - Skeptical of more requests</div>
                </div>
            </div>
        </div>

        <!-- Metrics Trend Chart -->
        <div class="chart-section">
            <h2 class="section-title">Performance Trends</h2>
            <div class="chart-container">
                <canvas id="metricsChart"></canvas>
            </div>
        </div>

        <!-- Decision History -->
        <div class="history-section">
            <h2 class="section-title">Decision History</h2>
            <div id="historyContainer">
                <p style="color: var(--text-secondary); text-align: center;">No decisions made yet. Click "Next Week" to begin.</p>
            </div>
        </div>
    </div>

    <!-- Side Panel for Decisions -->
    <div class="side-panel" id="decisionPanel">
        <div class="panel-header">
            <h2 class="panel-title" id="panelTitle">Decision Required</h2>
            <p class="panel-week" id="panelWeek">Week 1</p>
        </div>
        <div class="panel-body">
            <div id="branchingNotice"></div>
            <div class="problem-statement">
                <h3>Current Situation</h3>
                <p id="problemText"></p>
            </div>
            <div class="options-container" id="optionsContainer"></div>
            <div class="feedback-panel" id="feedbackPanel">
                <div class="feedback-title" id="feedbackTitle"></div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>
        </div>
        <div class="panel-footer">
            <button class="btn btn-primary" id="continueBtn" disabled>Continue to Next Week</button>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="completion-modal" id="completionModal">
        <div class="completion-content">
            <div class="completion-header">
                <h2 class="completion-title">Simulation Complete!</h2>
                <p class="completion-subtitle">7 weeks of adaptive leadership</p>
            </div>
            <div class="completion-body">
                <div style="text-align: center;">
                    <div class="performance-badge" id="performanceBadge">Excellent Performance</div>
                </div>
                
                <div class="metrics-summary">
                    <div class="summary-row">
                        <span class="summary-label">Response Time:</span>
                        <span class="summary-value" id="finalResponseTime">--</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Customer Satisfaction:</span>
                        <span class="summary-value" id="finalSatisfaction">--</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Resolution Rate:</span>
                        <span class="summary-value" id="finalResolution">--</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Stakeholder Trust:</span>
                        <span class="summary-value" id="finalStakeholder">--</span>
                    </div>
                </div>

                <div class="key-insight">
                    <h3>Leadership Assessment</h3>
                    <p id="keyInsightText"></p>
                </div>
            </div>
            <div class="completion-footer">
                <button class="btn btn-primary" onclick="closeCompletionModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ===== STATE MANAGEMENT =====
        const state = {
            currentWeek: 1,
            metrics: {
                responseTime: 48,
                satisfaction: 68,
                resolution: 52
            },
            stakeholders: {
                sales: 45,
                team: 55,
                tech: 60
            },
            history: [],
            metricsHistory: [
                { week: 0, responseTime: 33, satisfaction: 83, resolution: 67 }
            ],
            decisionPath: [],
            branchingState: 'normal'
        };

        // ===== SCENARIO DATA =====
        const scenarios = [
            {
                week: 1,
                problem: "Your inbox explodes Monday morning. Sales is furious‚Äîclients are complaining about 48-hour response times when they were promised 24 hours. Your team is overwhelmed and defensive, saying 'We're doing our best with what we have.' Tech says they can't build you more tools this quarter. Everyone wants a meeting with you today. How do you respond?",
                options: [
                    {
                        label: "Schedule individual meetings with each stakeholder",
                        text: "Meet with Sales, your team, and Tech separately to hear their perspectives and address concerns.",
                        outcome: "poor",
                        decisionQuality: "poor",
                        impact: {
                            responseTime: 2,
                            satisfaction: -3,
                            resolution: -2,
                            sales: -5,
                            team: -8,
                            tech: -5
                        },
                        feedback: {
                            type: "danger",
                            title: "Reactive firefighting",
                            content: "You spent 6 hours in back-to-back meetings. Each group vented. Sales blamed your team. Your team blamed Sales for overpromising. Tech said they're slammed. You're exhausted, nothing changed, and everyone feels unheard because you're just collecting complaints without a strategy."
                        }
                    },
                    {
                        label: "Diagnose the process mismatch first",
                        text: "Postpone meetings by 48 hours. Spend time mapping the actual workflow vs. what was designed, looking for systemic gaps.",
                        outcome: "excellent",
                        decisionQuality: "excellent",
                        impact: {
                            responseTime: 0,
                            satisfaction: 3,
                            resolution: 2,
                            sales: 8,
                            team: 10,
                            tech: 12
                        },
                        feedback: {
                            type: "success",
                            title: "Getting on the balcony",
                            content: "You discovered the root cause: Sales sells one-size-fits-all support, but customers need three different service levels. Your single-queue process can't optimize for both speed AND customization. When you share this diagnosis with stakeholders, everyone stops blaming each other and starts problem-solving."
                        }
                    },
                    {
                        label: "Push back on Sales immediately",
                        text: "Tell Sales to stop overpromising. They need to align their commitments with your current capacity.",
                        outcome: "partial",
                        decisionQuality: "poor",
                        impact: {
                            responseTime: 0,
                            satisfaction: -2,
                            resolution: -1,
                            sales: -15,
                            team: 8,
                            tech: 0
                        },
                        feedback: {
                            type: "warning",
                            title: "Protecting your team, burning bridges",
                            content: "Your team appreciates you standing up for them. But Sales leadership escalates to your VP, saying you're 'not a team player.' The real problem‚Äîprocess design‚Äîremains unsolved. You've treated this as a Sales problem when it's a systems problem."
                        }
                    },
                    {
                        label: "Ask Tech to build automation immediately",
                        text: "Request urgent help from Tech to automate ticket routing and responses to reduce the load.",
                        outcome: "poor",
                        decisionQuality: "partial",
                        impact: {
                            responseTime: 1,
                            satisfaction: 0,
                            resolution: 0,
                            sales: 0,
                            team: -3,
                            tech: -12
                        },
                        feedback: {
                            type: "warning",
                            title: "Solution before diagnosis",
                            content: "Tech pushes back hard. You don't even know what to automate yet. They're already underwater with product work. Relationship damaged. Your team feels you're looking for tech silver bullets instead of understanding their reality."
                        }
                    }
                ],
            },
            {
                week: 2,
                problem: "Your diagnosis revealed that enterprise clients need fast, personalized service while small customers just want quick template responses. But your single process tries to serve everyone the same way. Sales says 'just hire more people.' Your team says 'we need better tools.' Tech says 'we need clearer requirements.' How do you move forward?",
                getBranchedOptions: function(branchingState) {
                    const baseOptions = [
                        {
                            label: "Hire 3 temporary contractors",
                            text: "Address the volume problem immediately by bringing on extra hands to reduce the backlog.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: -4,
                                satisfaction: 0,
                                resolution: -2,
                                sales: 3,
                                team: -8,
                                tech: 0
                            },
                            feedback: {
                                type: "danger",
                                title: "Adding capacity to a broken system",
                                content: "Contractors help briefly, but they don't understand context so quality drops. Training takes 3 weeks. By week 8 they leave, and you're back where you started. Costs increased 18% with no lasting improvement. You added resources to an unchanged process."
                            }
                        },
                        {
                            label: "Design tiered service pathways",
                            text: "Create three distinct processes: VIP (enterprise, personalized), Standard (balanced), Self-Service (template-driven). Each optimized differently.",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: -6,
                                satisfaction: 8,
                                resolution: 7,
                                sales: 15,
                                team: 12,
                                tech: 10
                            },
                            feedback: {
                                type: "success",
                                title: "Adaptive process architecture",
                                content: "By accepting you can't optimize one process for all needs, you solved the impossible trade-off. Sales can now promise differentiated service. Your team isn't stretched thin trying to personalize everything. Tech sees clear requirements for each tier. This is adaptive leadership‚Äîchanging the system, not just working harder."
                            },
                            requiredState: 'normal'
                        },
                        {
                            label: "Implement AI chatbot for tier 1 support",
                            text: "Use technology to handle simple queries automatically, freeing your team for complex issues.",
                            outcome: "partial",
                            decisionQuality: "partial",
                            impact: {
                                responseTime: -2,
                                satisfaction: 2,
                                resolution: 1,
                                sales: 3,
                                team: 0,
                                tech: -5
                            },
                            feedback: {
                                type: "warning",
                                title: "Technology before strategy",
                                content: "Chatbot helps with 25% of volume but you still have a single undifferentiated process. Enterprise clients frustrated when routed to bot. You're automating symptoms, not fixing the root cause. Tech annoyed by vague requirements."
                            }
                        }
                    ];

                    if (branchingState === 'struggling') {
                        return [
                            baseOptions[0],
                            {
                                label: "Two-tier service model",
                                text: "Simplified approach: Premium (paying customers) and Standard (everyone else). Less complex than three tiers.",
                                outcome: "partial",
                                decisionQuality: "partial",
                                impact: {
                                    responseTime: -3,
                                    satisfaction: 5,
                                    resolution: 4,
                                    sales: 8,
                                    team: 6,
                                    tech: 5
                                },
                                feedback: {
                                    type: "success",
                                    title: "Recovery through simplicity",
                                    content: "Given your earlier missteps, stakeholders appreciate this pragmatic approach. Two tiers are easier to manage than three. Results are good though not optimal. You're rebuilding trust through clear, achievable improvements."
                                }
                            },
                            baseOptions[2]
                        ];
                    } else if (branchingState === 'crisis') {
                        return [
                            {
                                label: "Emergency priority system",
                                text: "Basic triage: Urgent (revenue risk) vs. Standard (everything else). Just to stop the bleeding.",
                                outcome: "partial",
                                decisionQuality: "poor",
                                impact: {
                                    responseTime: -2,
                                    satisfaction: 2,
                                    resolution: 1,
                                    sales: 6,
                                    team: -3,
                                    tech: 0
                                },
                                feedback: {
                                    type: "warning",
                                    title: "Survival mode",
                                    content: "You're in damage control. Basic prioritization helps but doesn't solve the fundamental design problem. Sales slightly happier. Team sees this as reactive, not strategic. You're still treating symptoms."
                                }
                            },
                            baseOptions[0],
                            baseOptions[2]
                        ];
                    }

                    return baseOptions;
                }
            },
            {
                week: 3,
                problem: "You've designed a tiered service model. But Sales wants it launched immediately to save Q4 deals. Your team is nervous about execution. Tech wants a 6-week pilot. Leadership is pressuring you for 'quick wins.' You're getting pulled in four directions. How do you regulate this distress?",
                getBranchedOptions: function(branchingState) {
                    const baseOptions = [
                        {
                            label: "Launch everything immediately to show results",
                            text: "Full rollout across all customers this week. Make adjustments in flight to build momentum.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 8,
                                satisfaction: -10,
                                resolution: -6,
                                sales: -15,
                                team: -20,
                                tech: -15
                            },
                            feedback: {
                                type: "danger",
                                title: "Pressure led to panic",
                                content: "Classification errors everywhere. Agents confused about which tier to use. System crashed under load. Major enterprise client escalated to CEO after being misrouted to self-service. You absorbed everyone's anxiety and made a fear-based decision. Had to roll back‚Äîcredibility shattered."
                            }
                        },
                        {
                            label: "Run a controlled 4-week pilot with 20% of volume",
                            text: "Firm boundary: 'We'll test with a subset, learn, adjust, then scale confidently. No shortcuts.'",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: -5,
                                satisfaction: 7,
                                resolution: 6,
                                sales: 10,
                                team: 12,
                                tech: 15
                            },
                            feedback: {
                                type: "success",
                                title: "Holding steady under pressure",
                                content: "You regulated the distress. Told Sales: 'I understand urgency, but a failed launch hurts Q4 more than waiting 4 weeks.' Pilot revealed edge cases you'd never have predicted. Scaled with confidence. Stakeholders see you won't cave to pressure‚Äîyou make sound decisions."
                            }
                        },
                        {
                            label: "Let each stakeholder run their own pilot",
                            text: "Sales tests with their priority accounts, Tech tests their way, your team picks cases. Distributed approach.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 3,
                                satisfaction: -4,
                                resolution: -3,
                                sales: -5,
                                team: -8,
                                tech: -10
                            },
                            feedback: {
                                type: "danger",
                                title: "Avoiding the heat by diffusing ownership",
                                content: "You tried to make everyone happy by giving everyone control. Result: three inconsistent pilots, no shared learning, contradictory data. No one owns outcomes. This is avoiding leadership, not adaptive leadership."
                            }
                        }
                    ];

                    if (branchingState === 'crisis') {
                        baseOptions[1].locked = true;
                        baseOptions[1].lockedReason = "Stakeholder trust is too low for a lengthy pilot. They need to see improvement now.";
                    }

                    return baseOptions;
                }
            },
            {
                week: 4,
                problem: "Pilot results are in‚Äîtiered service works! But now your team is divided. Senior agents love the VIP tier (interesting work, happy customers). Junior agents feel stuck with low-tier 'grunt work' and resent it. Two have threatened to quit. How do you address this adaptive challenge within your team?",
                getBranchedOptions: function(branchingState) {
                    return [
                        {
                            label: "Rotate everyone through all tiers equally",
                            text: "Make it fair by having every agent spend time in each tier to avoid hierarchy resentment.",
                            outcome: "partial",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 3,
                                satisfaction: -3,
                                resolution: -2,
                                sales: -8,
                                team: -5,
                                tech: 0
                            },
                            feedback: {
                                type: "warning",
                                title: "Equality over effectiveness",
                                content: "Senior agents frustrated that expertise isn't valued. VIP customers get inconsistent service when juniors rotate in. You prioritized internal fairness over customer outcomes. This is a technical solution (rotation policy) to an adaptive challenge (career development)."
                            }
                        },
                        {
                            label: "Create clear growth pathways across tiers",
                            text: "Map how agents develop from Standard ‚Üí VIP tier, with skills, metrics, and mentorship at each level.",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: -4,
                                satisfaction: 6,
                                resolution: 5,
                                sales: 8,
                                team: 18,
                                tech: 5
                            },
                            feedback: {
                                type: "success",
                                title: "Giving the work back to them",
                                content: "You facilitated a session where agents themselves defined what 'VIP-ready' looks like. Self-Service becomes training ground. Standard tier is progression. VIP is earned mastery. Junior agents now see a path, not a ceiling. You didn't solve it for them‚Äîyou helped them own their development."
                            }
                        },
                        {
                            label: "Pay differential for VIP tier work",
                            text: "Compensate senior agents more for handling complex VIP cases to recognize the difficulty.",
                            outcome: "partial",
                            decisionQuality: "partial",
                            impact: {
                                responseTime: -1,
                                satisfaction: 2,
                                resolution: 2,
                                sales: 3,
                                team: 5,
                                tech: 0
                            },
                            feedback: {
                                type: "warning",
                                title: "Money doesn't solve adaptive challenges",
                                content: "Pay helps short-term but doesn't address junior agents' desire for growth and meaning. You've created a compensation tier without a development system. People want mastery and purpose, not just money."
                            }
                        }
                    ];
                }
            },
            {
                week: 5,
                problem: "You're scaling from 20% to 100% of customers. But you realize you make every decision‚Äîagent escalations, tier classification edge cases, customer exceptions. When you're in meetings, work stops. Your team looks to you for answers instead of thinking independently. How do you distribute leadership?",
                getBranchedOptions: function(branchingState) {
                    const baseOptions = [
                        {
                            label: "Document every decision in a detailed playbook",
                            text: "Create comprehensive guidelines for every scenario so agents can reference the manual instead of asking you.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 4,
                                satisfaction: -5,
                                resolution: -4,
                                sales: -6,
                                team: -12,
                                tech: -3
                            },
                            feedback: {
                                type: "danger",
                                title: "Technical fix to adaptive challenge",
                                content: "120-page playbook created. But it can't cover every edge case. Agents follow rules mechanically even when context suggests otherwise. They stop thinking critically. New issues arise that aren't in the playbook‚Äîand decision-making freezes. You've removed judgment, not built capacity."
                            }
                        },
                        {
                            label: "Define decision authority levels + learning cycles",
                            text: "Specify what agents decide (routine), what team leads decide (non-routine), what needs you (strategic). Build weekly learning sessions to elevate judgment.",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: -5,
                                satisfaction: 7,
                                resolution: 6,
                                sales: 10,
                                team: 20,
                                tech: 8
                            },
                            feedback: {
                                type: "success",
                                title: "Building adaptive capacity",
                                content: "You gave the work back. 80% of decisions now happen locally. Weekly 'edge case huddles' where team discusses judgment calls. People own outcomes instead of deferring to you. When you're out, work continues. You've built a learning organization, not a dependency culture."
                            }
                        },
                        {
                            label: "Promote two senior agents to Team Lead roles",
                            text: "Create a management layer. They handle day-to-day decisions and escalations on your behalf.",
                            outcome: "partial",
                            decisionQuality: "partial",
                            impact: {
                                responseTime: -2,
                                satisfaction: 4,
                                resolution: 3,
                                sales: 5,
                                team: 8,
                                tech: 2
                            },
                            feedback: {
                                type: "warning",
                                title: "Structure without empowerment",
                                content: "Team leads help but they just become mini-you, creating a new bottleneck. Agents still don't develop judgment‚Äîthey just escalate to leads instead of you. Better than before, but you haven't distributed real decision-making authority."
                            }
                        }
                    ];

                    if (branchingState === 'crisis') {
                        baseOptions[1].locked = true;
                        baseOptions[1].lockedReason = "Team trust is too fractured for distributed authority right now. Need more structure first.";
                    }

                    return baseOptions;
                }
            },
            {
                week: 6,
                problem: "Customer expectations have shifted‚Äîthey now want live chat support, not just email/phone. Sales is already selling it. But adding chat would completely overwhelm your team, who barely have bandwidth now. Tech can build it but not maintain two support systems. How do you adapt to changing reality?",
                getBranchedOptions: function(branchingState) {
                    return [
                        {
                            label: "Deploy chat across all tiers immediately",
                            text: "Meet market expectations. Train everyone on chat this week and launch to stay competitive.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 7,
                                satisfaction: -8,
                                resolution: -6,
                                sales: -10,
                                team: -18,
                                tech: -12
                            },
                            feedback: {
                                type: "danger",
                                title: "Overextension without learning",
                                content: "Agents trying to handle chat, email, and phone simultaneously. Response quality crashes across all channels. Team burnout spikes‚Äîthree people quit. Chat response times averaging 45 minutes (customers expect <5 min). You stretched capacity without changing process."
                            }
                        },
                        {
                            label: "Pilot chat in VIP tier only, learn, then expand",
                            text: "Test with enterprise customers where stakes are highest and volume is manageable. Refine before scaling.",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: -3,
                                satisfaction: 6,
                                resolution: 5,
                                sales: 12,
                                team: 8,
                                tech: 10
                            },
                            feedback: {
                                type: "success",
                                title: "Iterative adaptation to new demands",
                                content: "VIP pilot revealed chat needs different staffing ratios than email. You learned concurrent chat limits (3 per agent max). Workflow adjustments made. Enterprise loves it. Now scaling to Standard tier with confidence. You adapted the system to reality, not reality to wishes."
                            }
                        },
                        {
                            label: "Outsource chat to specialized vendor",
                            text: "Contract with chat support company while you focus on core email/phone channels with your team.",
                            outcome: "partial",
                            decisionQuality: "partial",
                            impact: {
                                responseTime: -1,
                                satisfaction: 1,
                                resolution: 0,
                                sales: -5,
                                team: 3,
                                tech: 2
                            },
                            feedback: {
                                type: "warning",
                                title: "Speed over integration",
                                content: "Chat launches fast but vendor doesn't understand your tier model. VIP customers get generic responses. Integration with your systems is clunky. Two separate processes to manage. Quick fix, but not strategic."
                            }
                        }
                    ];
                }
            },
            {
                week: 7,
                problem: "Leadership announces budget cuts‚Äî15% reduction across all departments due to market conditions. Your improved process costs 8% more than the old one (tiered staffing, better tools, training). CFO asks: 'Can we just go back to the old way and cut costs?' Everyone is watching how you respond under this pressure.",
                getBranchedOptions: function(branchingState) {
                    return [
                        {
                            label: "Agree to cut back to single-tier process",
                            text: "Protect jobs by simplifying back to one service level and reducing tool costs.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 12,
                                satisfaction: -15,
                                resolution: -10,
                                sales: -25,
                                team: -15,
                                tech: -8
                            },
                            feedback: {
                                type: "danger",
                                title: "Reverting under pressure",
                                content: "Within 3 weeks, all your gains evaporated. Response times back to 45+ hours. Three enterprise clients switched to competitors (revenue loss: $1.8M). Team morale crushed‚Äî'We worked so hard for nothing.' Under pressure, you abandoned adaptive change and returned to the dysfunctional status quo."
                            }
                        },
                        {
                            label: "Present data-driven business case for the investment",
                            text: "Show ROI: customer retention value, reduced churn, efficiency gains. Make the case that cutting this costs more than it saves.",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: 0,
                                satisfaction: 4,
                                resolution: 3,
                                sales: 10,
                                team: 15,
                                tech: 8
                            },
                            feedback: {
                                type: "success",
                                title: "Leading upward with evidence",
                                content: "Your presentation: at-risk renewals saved ($2.1M), churn down 14%, NPS up 22 points. 8% cost increase delivers 30% value increase. CFO approves budget. You showed adaptive leadership works by protecting the change while acknowledging the pressure. Team sees you fight for what works, not what's comfortable."
                            }
                        },
                        {
                            label: "Propose strategic automation in Standard tier",
                            text: "Use AI to automate 40% of Standard tier volume, reducing costs while protecting VIP quality.",
                            outcome: "partial",
                            decisionQuality: "partial",
                            impact: {
                                responseTime: -2,
                                satisfaction: 3,
                                resolution: 2,
                                sales: 5,
                                team: 5,
                                tech: 6
                            },
                            feedback: {
                                type: "success",
                                title: "Compromise with innovation",
                                content: "Smart middle path. Automation reduces Standard tier costs by 7% while maintaining quality. VIP service untouched. Not as ideal as full funding, but you found a way to preserve core improvements while addressing budget reality. Pragmatic adaptation."
                            }
                        }
                    ];
                }
            }
        ];

        // ===== CHART INITIALIZATION =====
        let metricsChart;

        function initChart() {
            const ctx = document.getElementById('metricsChart').getContext('2d');
            metricsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Baseline'],
                    datasets: [
                        {
                            label: 'Response Time (hrs)',
                            data: [33],
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Satisfaction (%)',
                            data: [83],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Resolution (%)',
                            data: [67],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        if (context.datasetIndex === 0) {
                                            label += context.parsed.y + ' hrs';
                                        } else {
                                            label += context.parsed.y + '%';
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Response Time (hours)'
                            },
                            min: 0,
                            max: 60
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Percentage (%)'
                            },
                            min: 0,
                            max: 100,
                            grid: {
                                drawOnChartArea: false,
                            }
                        }
                    }
                }
            });
        }

        // ===== BRANCHING LOGIC =====
        function updateBranchingState() {
            const recentDecisions = state.decisionPath.slice(-3);
            const poorCount = recentDecisions.filter(d => d === 'poor').length;
            const excellentCount = recentDecisions.filter(d => d === 'excellent').length;

            if (poorCount >= 2) {
                state.branchingState = 'crisis';
            } else if (poorCount >= 1 && excellentCount === 0) {
                state.branchingState = 'struggling';
            } else {
                state.branchingState = 'normal';
            }
        }

        function getBranchingNoticeHTML() {
            if (state.branchingState === 'crisis') {
                return '<div class="branching-notice">‚ö†Ô∏è <strong>Crisis:</strong> Your earlier reactive decisions have damaged stakeholder trust. Some strategic options are no longer available.</div>';
            } else if (state.branchingState === 'struggling') {
                return '<div class="branching-notice warning">‚ö° <strong>Pressure Mounting:</strong> Stakeholders are watching closely. You need to rebuild confidence through thoughtful decisions.</div>';
            }
            return '';
        }

        // ===== UI UPDATE FUNCTIONS =====
        function updateMetricsDisplay() {
            document.getElementById('metricResponseTime').textContent = state.metrics.responseTime + 'hrs';
            document.getElementById('metricSatisfaction').textContent = state.metrics.satisfaction + '%';
            document.getElementById('metricResolution').textContent = state.metrics.resolution + '%';

            const rtChange = state.metrics.responseTime - 33;
            const satChange = state.metrics.satisfaction - 83;
            const resChange = state.metrics.resolution - 67;

            document.getElementById('changeResponseTime').textContent = 
                (rtChange >= 0 ? '‚Üë ' : '‚Üì ') + Math.abs(rtChange) + 'hrs from baseline';
            document.getElementById('changeResponseTime').className = 
                'metric-change ' + (rtChange >= 0 ? 'negative' : 'positive');

            document.getElementById('changeSatisfaction').textContent = 
                (satChange >= 0 ? '‚Üë ' : '‚Üì ') + Math.abs(satChange) + 'pts from baseline';
            document.getElementById('changeSatisfaction').className = 
                'metric-change ' + (satChange >= 0 ? 'positive' : 'negative');

            document.getElementById('changeResolution').textContent = 
                (resChange >= 0 ? '‚Üë ' : '‚Üì ') + Math.abs(resChange) + 'pts from baseline';
            document.getElementById('changeResolution').className = 
                'metric-change ' + (resChange >= 0 ? 'positive' : 'negative');
        }

        function updateStakeholders() {
            const stakeholders = ['sales', 'team', 'tech'];
            const labels = {
                sales: ['Sales Team', 'Angry about broken promises', 'Cautiously supportive', 'Strong partnership'],
                team: ['Service Team', 'Burned out and defensive', 'Engaged and hopeful', 'Empowered and thriving'],
                tech: ['Tech Team', 'Skeptical of more requests', 'Willing to collaborate', 'Enthusiastic partner']
            };

            stakeholders.forEach(sh => {
                const value = state.stakeholders[sh];
                const fill = document.getElementById('sat' + sh.charAt(0).toUpperCase() + sh.slice(1));
                const status = document.getElementById('status' + sh.charAt(0).toUpperCase() + sh.slice(1));

                fill.style.width = value + '%';

                if (value >= 70) {
                    fill.className = 'satisfaction-fill high';
                    status.textContent = value + '% - ' + labels[sh][3];
                } else if (value >= 50) {
                    fill.className = 'satisfaction-fill medium';
                    status.textContent = value + '% - ' + labels[sh][2];
                } else {
                    fill.className = 'satisfaction-fill low';
                    status.textContent = value + '% - ' + labels[sh][1];
                }
            });
        }

        function updateChart() {
            const labels = state.metricsHistory.map((_, idx) => idx === 0 ? 'Baseline' : 'Week ' + idx);
            const responseData = state.metricsHistory.map(m => m.responseTime);
            const satisfactionData = state.metricsHistory.map(m => m.satisfaction);
            const resolutionData = state.metricsHistory.map(m => m.resolution);

            metricsChart.data.labels = labels;
            metricsChart.data.datasets[0].data = responseData;
            metricsChart.data.datasets[1].data = satisfactionData;
            metricsChart.data.datasets[2].data = resolutionData;
            metricsChart.update();
        }

        function updateHistory() {
            const container = document.getElementById('historyContainer');
            
            if (state.history.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No decisions made yet.</p>';
                return;
            }

            container.innerHTML = '';
            state.history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item ' + item.outcome;
                div.innerHTML = `
                    <div class="history-week">Week ${item.week}</div>
                    <div class="history-problem"><strong>Situation:</strong> ${item.problem}</div>
                    <div class="history-action"><strong>Your Action:</strong> ${item.action}</div>
                    <div class="history-outcome"><strong>Result:</strong> ${item.outcomeText}</div>
                `;
                container.appendChild(div);
            });
        }

        // ===== INTRO SCREEN =====
        function startSimulation() {
            document.getElementById('introScreen').classList.add('hidden');
            setTimeout(showDecisionPanel, 1000);
        }

        // ===== MODAL FUNCTIONS =====
        function showDecisionPanel() {
            if (state.currentWeek > scenarios.length) {
                showCompletionModal();
                return;
            }

            const scenario = scenarios[state.currentWeek - 1];
            
            document.getElementById('panelTitle').textContent = 'Week ' + state.currentWeek + ' Challenge';
            document.getElementById('panelWeek').textContent = 'Week ' + state.currentWeek + ' of 7';
            
            document.getElementById('problemText').textContent = scenario.problem;
            document.getElementById('branchingNotice').innerHTML = getBranchingNoticeHTML();

            const options = scenario.getBranchedOptions ? 
                scenario.getBranchedOptions(state.branchingState) : 
                scenario.options;

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'option' + (option.locked ? ' locked' : '');
                div.innerHTML = `
                    <div class="option-label">Option ${index + 1}: ${option.label}</div>
                    <div class="option-text">${option.text}</div>
                    ${option.locked ? '<div class="option-locked-text">üîí ' + option.lockedReason + '</div>' : ''}
                `;
                
                if (!option.locked) {
                    div.onclick = () => selectOption(option, scenario, index);
                }
                
                optionsContainer.appendChild(div);
            });

            document.getElementById('feedbackPanel').classList.remove('active');
            document.getElementById('continueBtn').disabled = true;
            document.getElementById('decisionPanel').classList.add('active');
            document.getElementById('mainContainer').classList.add('panel-open');
        }

        function selectOption(option, scenario, index) {
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.add('disabled');
            });

            document.querySelectorAll('.option')[index].classList.add('selected');

            state.decisionPath.push(option.decisionQuality);
            updateBranchingState();

            state.metrics.responseTime += option.impact.responseTime;
            state.metrics.satisfaction += option.impact.satisfaction;
            state.metrics.resolution += option.impact.resolution;

            state.stakeholders.sales += option.impact.sales;
            state.stakeholders.team += option.impact.team;
            state.stakeholders.tech += option.impact.tech;

            state.metrics.responseTime = Math.max(15, Math.min(60, state.metrics.responseTime));
            state.metrics.satisfaction = Math.max(0, Math.min(100, state.metrics.satisfaction));
            state.metrics.resolution = Math.max(0, Math.min(100, state.metrics.resolution));

            state.stakeholders.sales = Math.max(0, Math.min(100, state.stakeholders.sales));
            state.stakeholders.team = Math.max(0, Math.min(100, state.stakeholders.team));
            state.stakeholders.tech = Math.max(0, Math.min(100, state.stakeholders.tech));

            state.history.push({
                week: state.currentWeek,
                problem: scenario.problem,
                action: option.label,
                outcomeText: option.feedback.content,
                outcome: option.feedback.type
            });

            state.metricsHistory.push({
                week: state.currentWeek,
                responseTime: state.metrics.responseTime,
                satisfaction: state.metrics.satisfaction,
                resolution: state.metrics.resolution
            });

            const feedback = document.getElementById('feedbackPanel');
            feedback.className = 'feedback-panel active ' + option.feedback.type;
            document.getElementById('feedbackTitle').textContent = option.feedback.title;
            document.getElementById('feedbackContent').textContent = option.feedback.content;

            document.getElementById('continueBtn').disabled = false;
        }

        function continueToNextWeek() {
            state.currentWeek++;
            document.getElementById('weekNumber').textContent = 'Week ' + state.currentWeek;
            
            updateMetricsDisplay();
            updateStakeholders();
            updateChart();
            updateHistory();

            document.getElementById('decisionPanel').classList.remove('active');
            document.getElementById('mainContainer').classList.remove('panel-open');

            if (state.currentWeek <= scenarios.length) {
                setTimeout(showDecisionPanel, 800);
            } else {
                showCompletionModal();
            }
        }

        function showCompletionModal() {
            const avgStakeholder = Math.round(
                (state.stakeholders.sales + state.stakeholders.team + state.stakeholders.tech) / 3
            );

            let performance = 'Developing Leader';
            let performanceClass = 'good';
            
            if (state.metrics.satisfaction >= 85 && avgStakeholder >= 75) {
                performance = 'Adaptive Leader';
                performanceClass = 'excellent';
            } else if (state.metrics.satisfaction < 70 || avgStakeholder < 50) {
                performance = 'Technical Manager';
                performanceClass = 'needs-improvement';
            }

            document.getElementById('performanceBadge').textContent = performance;
            document.getElementById('performanceBadge').className = 'performance-badge ' + performanceClass;
            
            document.getElementById('finalResponseTime').textContent = state.metrics.responseTime + ' hrs';
            document.getElementById('finalSatisfaction').textContent = state.metrics.satisfaction + '%';
            document.getElementById('finalResolution').textContent = state.metrics.resolution + '%';
            document.getElementById('finalStakeholder').textContent = avgStakeholder + '%';
            
            document.getElementById('keyInsightText').textContent = getKeyInsight();

            document.getElementById('completionModal').classList.add('active');
        }

        function closeCompletionModal() {
            document.getElementById('completionModal').classList.remove('active');
        }

        function getKeyInsight() {
            const excellentDecisions = state.decisionPath.filter(d => d === 'excellent').length;
            
            if (excellentDecisions >= 5) {
                return 'You demonstrated adaptive leadership: diagnosing root causes over symptoms, regulating distress under pressure, giving work back to develop others, and making evidence-based decisions. You treated process challenges as opportunities for systemic change, not just technical fixes.';
            } else if (excellentDecisions >= 3) {
                return 'You showed adaptive thinking in key moments but occasionally reverted to reactive problem-solving. Continue developing your ability to distinguish technical problems (apply best practices) from adaptive challenges (require new learning). Step onto the balcony more often.';
            } else {
                return 'Your approach favored quick fixes over systemic diagnosis, and reacting to pressure over regulating distress. Adaptive leadership means seeing patterns, not just problems. Focus on: What is the underlying mismatch? Whose problem is this to solve? What can only I do vs. what should others own?';
            }
        }

        // ===== EVENT LISTENERS =====
        document.getElementById('continueBtn').addEventListener('click', continueToNextWeek);

        // ===== INITIALIZATION =====
        initChart();
        updateMetricsDisplay();
        updateStakeholders();
        updateHistory();
    </script>
</body>
</html>