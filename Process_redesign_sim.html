<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adaptive Process Management Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            transition: margin-right 0.3s ease;
        }

        .container.panel-open {
            margin-right: 450px;
        }

        /* Header */
        .header {
            background: var(--bg-card);
            padding: 24px;
            margin-bottom: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .header .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .week-display {
            text-align: right;
        }

        .week-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
        }

        .week-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        /* Metric Cards */
        .metric-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .metric-label {
            font-size: 13px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .metric-change {
            font-size: 14px;
            font-weight: 600;
        }

        .metric-change.positive {
            color: var(--success);
        }

        .metric-change.negative {
            color: var(--danger);
        }

        /* Stakeholder Section */
        .stakeholder-section {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .stakeholder-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .stakeholder-card {
            padding: 16px;
            border-radius: 8px;
            border: 2px solid var(--border);
            background: #f8fafc;
        }

        .stakeholder-name {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .satisfaction-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .satisfaction-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .satisfaction-fill.high {
            background: var(--success);
        }

        .satisfaction-fill.medium {
            background: var(--warning);
        }

        .satisfaction-fill.low {
            background: var(--danger);
        }

        .stakeholder-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Chart Section */
        .chart-section {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Decision History */
        .history-section {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .history-item {
            padding: 16px;
            border-left: 4px solid var(--primary);
            background: #f8fafc;
            border-radius: 4px;
            margin-bottom: 12px;
        }

        .history-item.success {
            border-left-color: var(--success);
        }

        .history-item.warning {
            border-left-color: var(--warning);
        }

        .history-item.danger {
            border-left-color: var(--danger);
        }

        .history-week {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .history-problem {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .history-action {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .history-outcome {
            font-size: 13px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Side Panel */
        .side-panel {
            position: fixed;
            top: 0;
            right: -500px;
            width: 500px;
            height: 100vh;
            background: var(--bg-card);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
            transition: right 0.3s ease;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .side-panel.active {
            right: 0;
        }

        .panel-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-main);
        }

        .panel-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .panel-week {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .problem-statement {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 16px;
            border-radius: 4px;
            margin-bottom: 24px;
        }

        .problem-statement h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #92400e;
        }

        .problem-statement p {
            font-size: 14px;
            color: #78350f;
            line-height: 1.6;
        }

        .branching-notice {
            background: #fee2e2;
            border-left: 4px solid var(--danger);
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 13px;
            color: #991b1b;
        }

        .branching-notice.warning {
            background: #fef3c7;
            border-left-color: var(--warning);
            color: #92400e;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .option:hover:not(.disabled) {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .option.selected {
            border-color: var(--primary);
            background: #dbeafe;
        }

        .option.disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        .option.locked {
            background: #f1f5f9;
            border-color: #cbd5e1;
            opacity: 0.6;
        }

        .option-label {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .option.locked .option-label {
            color: var(--text-secondary);
        }

        .option-text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .option-locked-text {
            font-size: 12px;
            color: var(--danger);
            font-style: italic;
            margin-top: 4px;
        }

        .feedback-panel {
            background: #dbeafe;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            display: none;
        }

        .feedback-panel.active {
            display: block;
        }

        .feedback-panel.success {
            background: #d1fae5;
            border-color: var(--success);
        }

        .feedback-panel.warning {
            background: #fef3c7;
            border-color: var(--warning);
        }

        .feedback-panel.danger {
            background: #fee2e2;
            border-color: var(--danger);
        }

        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .feedback-content {
            font-size: 14px;
            line-height: 1.6;
        }

        .panel-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border);
            background: var(--bg-main);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Completion Modal */
        .completion-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .completion-modal.active {
            display: flex;
        }

        .completion-content {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.3);
        }

        .completion-header {
            padding: 32px 32px 24px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .completion-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .completion-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .completion-body {
            padding: 32px;
        }

        .performance-badge {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 24px;
        }

        .performance-badge.excellent {
            background: #d1fae5;
            color: #065f46;
        }

        .performance-badge.good {
            background: #dbeafe;
            color: #1e40af;
        }

        .performance-badge.needs-improvement {
            background: #fee2e2;
            color: #991b1b;
        }

        .metrics-summary {
            background: var(--bg-main);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .summary-value {
            font-weight: bold;
            color: var(--text-primary);
        }

        .key-insight {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 16px;
            border-radius: 4px;
            margin-bottom: 24px;
        }

        .key-insight h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #92400e;
        }

        .key-insight p {
            font-size: 14px;
            color: #78350f;
            line-height: 1.6;
        }

        .completion-footer {
            padding: 24px 32px;
            border-top: 1px solid var(--border);
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard,
            .stakeholder-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .week-display {
                text-align: center;
            }

            .side-panel {
                width: 100%;
                right: -100%;
            }

            .container.panel-open {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>Customer Service Process Redesign</h1>
                <p class="subtitle">Adaptive Process Management Simulation</p>
            </div>
            <div class="week-display">
                <div class="week-number" id="weekNumber">Week 1</div>
                <div class="week-label">Current Week</div>
            </div>
        </div>

        <!-- Key Metrics Dashboard -->
        <div class="dashboard">
            <div class="metric-card">
                <div class="metric-label">Response Time</div>
                <div class="metric-value" id="metricResponseTime">48hrs</div>
                <div class="metric-change negative" id="changeResponseTime">↑ 15hrs from baseline</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Customer Satisfaction</div>
                <div class="metric-value" id="metricSatisfaction">68%</div>
                <div class="metric-change negative" id="changeSatisfaction">↓ 15pts from baseline</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Resolution Rate</div>
                <div class="metric-value" id="metricResolution">52%</div>
                <div class="metric-change negative" id="changeResolution">↓ 15pts from baseline</div>
            </div>
        </div>

        <!-- Stakeholder Status -->
        <div class="stakeholder-section">
            <h2 class="section-title">Stakeholder Satisfaction</h2>
            <div class="stakeholder-grid">
                <div class="stakeholder-card">
                    <div class="stakeholder-name">Enterprise Clients</div>
                    <div class="satisfaction-bar">
                        <div class="satisfaction-fill low" id="satEnterprise" style="width: 45%"></div>
                    </div>
                    <div class="stakeholder-status" id="statusEnterprise">45% - Frustrated with delays</div>
                </div>
                <div class="stakeholder-card">
                    <div class="stakeholder-name">Support Team</div>
                    <div class="satisfaction-bar">
                        <div class="satisfaction-fill medium" id="satTeam" style="width: 60%"></div>
                    </div>
                    <div class="stakeholder-status" id="statusTeam">60% - Overwhelmed by volume</div>
                </div>
                <div class="stakeholder-card">
                    <div class="stakeholder-name">Leadership</div>
                    <div class="satisfaction-bar">
                        <div class="satisfaction-fill low" id="satLeadership" style="width: 50%"></div>
                    </div>
                    <div class="stakeholder-status" id="statusLeadership">50% - Concerned about costs</div>
                </div>
            </div>
        </div>

        <!-- Metrics Trend Chart -->
        <div class="chart-section">
            <h2 class="section-title">Performance Trends</h2>
            <div class="chart-container">
                <canvas id="metricsChart"></canvas>
            </div>
        </div>

        <!-- Decision History -->
        <div class="history-section">
            <h2 class="section-title">Decision History</h2>
            <div id="historyContainer">
                <p style="color: var(--text-secondary); text-align: center;">No decisions made yet. Click "Next Week" to begin.</p>
            </div>
        </div>
    </div>

    <!-- Side Panel for Decisions -->
    <div class="side-panel" id="decisionPanel">
        <div class="panel-header">
            <h2 class="panel-title" id="panelTitle">Decision Required</h2>
            <p class="panel-week" id="panelWeek">Week 1</p>
        </div>
        <div class="panel-body">
            <div id="branchingNotice"></div>
            <div class="problem-statement">
                <h3>Current Challenge</h3>
                <p id="problemText"></p>
            </div>
            <div class="options-container" id="optionsContainer"></div>
            <div class="feedback-panel" id="feedbackPanel">
                <div class="feedback-title" id="feedbackTitle"></div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>
        </div>
        <div class="panel-footer">
            <button class="btn btn-primary" id="continueBtn" disabled>Continue to Next Week</button>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="completion-modal" id="completionModal">
        <div class="completion-content">
            <div class="completion-header">
                <h2 class="completion-title">Simulation Complete!</h2>
                <p class="completion-subtitle">7 weeks of adaptive process management</p>
            </div>
            <div class="completion-body">
                <div style="text-align: center;">
                    <div class="performance-badge" id="performanceBadge">Excellent Performance</div>
                </div>
                
                <div class="metrics-summary">
                    <div class="summary-row">
                        <span class="summary-label">Response Time:</span>
                        <span class="summary-value" id="finalResponseTime">--</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Customer Satisfaction:</span>
                        <span class="summary-value" id="finalSatisfaction">--</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Resolution Rate:</span>
                        <span class="summary-value" id="finalResolution">--</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Average Stakeholder Satisfaction:</span>
                        <span class="summary-value" id="finalStakeholder">--</span>
                    </div>
                </div>

                <div class="key-insight">
                    <h3>Key Insight</h3>
                    <p id="keyInsightText"></p>
                </div>
            </div>
            <div class="completion-footer">
                <button class="btn btn-primary" onclick="closeCompletionModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ===== STATE MANAGEMENT =====
        const state = {
            currentWeek: 1,
            metrics: {
                responseTime: 48,
                satisfaction: 68,
                resolution: 52
            },
            stakeholders: {
                enterprise: 45,
                team: 60,
                leadership: 50
            },
            history: [],
            metricsHistory: [
                { week: 0, responseTime: 33, satisfaction: 83, resolution: 67 }
            ],
            decisionPath: [], // Track quality of decisions
            branchingState: 'normal' // 'normal', 'struggling', 'crisis'
        };

        // ===== SCENARIO DATA =====
        const scenarios = [
            {
                week: 1,
                problem: "Response times have increased 45% and customer satisfaction has dropped 15 points. Enterprise clients are escalating issues, the support team feels overwhelmed, and leadership is concerned about rising costs without improved outcomes.",
                options: [
                    {
                        label: "Add more staff and extend hours",
                        text: "Hire temporary agents and increase overtime to handle the volume spike.",
                        outcome: "partial",
                        decisionQuality: "poor",
                        impact: {
                            responseTime: -3,
                            satisfaction: -2,
                            resolution: 0,
                            enterprise: -5,
                            team: -10,
                            leadership: -8
                        },
                        feedback: {
                            type: "warning",
                            title: "Short-term relief, long-term problems",
                            content: "Response times improved slightly but quality dropped. Agent burnout increased and costs rose 25%. The root cause—process mismatch with customer needs—remains unaddressed."
                        }
                    },
                    {
                        label: "Analyze process design assumptions",
                        text: "Map what the process was designed for vs. current reality to identify systemic mismatches.",
                        outcome: "excellent",
                        decisionQuality: "excellent",
                        impact: {
                            responseTime: 0,
                            satisfaction: 2,
                            resolution: 0,
                            enterprise: 5,
                            team: 5,
                            leadership: 8
                        },
                        feedback: {
                            type: "success",
                            title: "Root cause identified",
                            content: "You discovered the process was designed for standardized queries, but 60% now require customization. Different customer segments need different service approaches. This insight sets up future improvements."
                        }
                    },
                    {
                        label: "Implement AI routing",
                        text: "Deploy AI to analyze tickets and route them more intelligently to available agents.",
                        outcome: "partial",
                        decisionQuality: "partial",
                        impact: {
                            responseTime: -2,
                            satisfaction: 1,
                            resolution: 0,
                            enterprise: 0,
                            team: -3,
                            leadership: 3
                        },
                        feedback: {
                            type: "warning",
                            title: "Technology without strategy",
                            content: "AI improved routing slightly but couldn't solve the fundamental issue: you're still using one process for all customer types. The technology automated confusion rather than eliminating it."
                        }
                    },
                    {
                        label: "Collect all stakeholder complaints",
                        text: "Create a comprehensive list of issues raised by different departments and address each one.",
                        outcome: "poor",
                        decisionQuality: "poor",
                        impact: {
                            responseTime: 1,
                            satisfaction: -1,
                            resolution: -2,
                            enterprise: -3,
                            team: -5,
                            leadership: -5
                        },
                        feedback: {
                            type: "danger",
                            title: "Lost in the noise",
                            content: "You compiled 47 different complaints but no clear pattern emerged. Scattered efforts addressed symptoms without solving the systemic issue. Team feels you're reacting without a clear strategy."
                        }
                    }
                ]
            },
            {
                week: 2,
                problem: "You've identified that different customer segments need different service levels, but you can't optimize for speed, personalization, AND cost simultaneously. Enterprise clients need fast personalized service, but that's expensive. How do you redesign the process?",
                getBranchedOptions: function(branchingState) {
                    const baseOptions = [
                        {
                            label: "Optimize the current single process",
                            text: "Keep one queue but improve routing, training, and knowledge base to serve everyone better.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: -2,
                                satisfaction: 2,
                                resolution: 1,
                                enterprise: 0,
                                team: -2,
                                leadership: 0
                            },
                            feedback: {
                                type: "warning",
                                title: "Marginal improvements only",
                                content: "Slight improvements but you're still trying to make one process serve all needs. Enterprise clients still wait too long, and efficiency-focused handling frustrates customers who need personalization."
                            }
                        },
                        {
                            label: "Create tiered service processes",
                            text: "Design three service tiers: Enterprise VIP (fast, personalized), Standard (balanced), and Self-Service (efficient, template-driven).",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: -8,
                                satisfaction: 10,
                                resolution: 8,
                                enterprise: 20,
                                team: 10,
                                leadership: 15
                            },
                            feedback: {
                                type: "success",
                                title: "Adaptive architecture established",
                                content: "By creating different processes for different needs, you've solved the impossible trade-off. Enterprise gets speed + personalization, standard customers get balanced service, and self-service users get fast template responses. Each segment is satisfied."
                            },
                            requiredState: 'normal'
                        },
                        {
                            label: "Let teams self-organize",
                            text: "Remove rigid structure and let agents choose tickets based on expertise and customer needs.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 4,
                                satisfaction: -3,
                                resolution: -3,
                                enterprise: -8,
                                team: 5,
                                leadership: -10
                            },
                            feedback: {
                                type: "danger",
                                title: "Autonomy without structure",
                                content: "Agents cherry-picked easy tickets. Complex issues languished. No predictable service levels emerged. Enterprise clients sometimes waited longer than individual users. Team loved the freedom but results suffered."
                            }
                        }
                    ];

                    if (branchingState === 'struggling') {
                        // Remove the excellent option and add a recovery path
                        return [
                            baseOptions[0],
                            {
                                label: "Simplified two-tier approach",
                                text: "Create just two tiers (Premium and Standard) to reduce complexity while still differentiating service.",
                                outcome: "partial",
                                decisionQuality: "partial",
                                locked: false,
                                impact: {
                                    responseTime: -4,
                                    satisfaction: 6,
                                    resolution: 4,
                                    enterprise: 10,
                                    team: 5,
                                    leadership: 8
                                },
                                feedback: {
                                    type: "success",
                                    title: "Pragmatic recovery",
                                    content: "Given your previous challenges, you chose a simpler approach. Two tiers are easier to manage than three, and still provide meaningful differentiation. Results are good, though not optimal."
                                }
                            },
                            baseOptions[2]
                        ];
                    } else if (branchingState === 'crisis') {
                        // Very limited options in crisis mode
                        return [
                            {
                                label: "Emergency triage system",
                                text: "Implement basic priority sorting: Urgent (paying customers) vs. Non-urgent (everyone else).",
                                outcome: "partial",
                                decisionQuality: "poor",
                                impact: {
                                    responseTime: -2,
                                    satisfaction: 3,
                                    resolution: 2,
                                    enterprise: 8,
                                    team: -2,
                                    leadership: 4
                                },
                                feedback: {
                                    type: "warning",
                                    title: "Damage control",
                                    content: "You're in survival mode. Basic triage helps enterprise clients but doesn't solve the fundamental design problem. You're still treating symptoms, not causes."
                                }
                            },
                            baseOptions[0],
                            baseOptions[2]
                        ];
                    }

                    return baseOptions;
                }
            },
            {
                week: 3,
                problem: "Your tiered process design looks good on paper, but you need to test it before full rollout. Leadership wants it implemented immediately. How do you proceed?",
                getBranchedOptions: function(branchingState) {
                    const baseOptions = [
                        {
                            label: "Full immediate rollout",
                            text: "Launch across all customers at once. We've done the analysis—commit fully and fix issues as they arise.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 8,
                                satisfaction: -8,
                                resolution: -5,
                                enterprise: -10,
                                team: -15,
                                leadership: -12
                            },
                            feedback: {
                                type: "danger",
                                title: "Big bang failure",
                                content: "Classification errors, system conflicts, and agent confusion created chaos. Customer complaints spiked. You're forced to roll back, losing credibility. Stakeholders now skeptical of any process changes."
                            }
                        },
                        {
                            label: "4-week controlled pilot",
                            text: "Test with 20% of customers, gather data weekly, adjust based on learnings, then scale gradually.",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: -6,
                                satisfaction: 8,
                                resolution: 6,
                                enterprise: 12,
                                team: 8,
                                leadership: 10
                            },
                            feedback: {
                                type: "success",
                                title: "Safe-to-fail experimentation",
                                content: "Pilot revealed classification edge cases and handoff bottlenecks you couldn't have predicted. You adjusted before full rollout. Now scaling with confidence and evidence. Team sees you learn and adapt, not just mandate."
                            }
                        },
                        {
                            label: "Enterprise clients only first",
                            text: "Launch Tier 1 (VIP) service only, prove value with high-revenue customers, then expand.",
                            outcome: "partial",
                            decisionQuality: "partial",
                            impact: {
                                responseTime: -3,
                                satisfaction: 4,
                                resolution: 2,
                                enterprise: 15,
                                team: 3,
                                leadership: 5
                            },
                            feedback: {
                                type: "warning",
                                title: "Partial learning",
                                content: "Enterprise clients very happy, but you didn't test interactions between tiers. When you add Tier 2/3 later, integration issues emerge. Slower learning than a full pilot would have provided."
                            }
                        }
                    ];

                    if (branchingState === 'crisis') {
                        // In crisis, pilot option is locked - must do quick fix
                        baseOptions[1].locked = true;
                        baseOptions[1].lockedReason = "Your earlier poor decisions have eroded trust. Leadership won't approve a lengthy pilot.";
                    }

                    return baseOptions;
                }
            },
            {
                week: 4,
                problem: "Your pilot validated the approach. Now you need to scale from 20% to 100% of customers. How do you manage the transition?",
                getBranchedOptions: function(branchingState) {
                    return [
                        {
                            label: "Rapid 2-week rollout",
                            text: "Train all agents intensively, flip the switch organization-wide, fix issues in production.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 4,
                                satisfaction: -5,
                                resolution: -3,
                                enterprise: -5,
                                team: -8,
                                leadership: -6
                            },
                            feedback: {
                                type: "warning",
                                title: "Speed over stability",
                                content: "Training was rushed, system bugs emerged under load, and volume predictions were wrong. Tier 1 overwhelmed. Had to pause and restabilize, delaying benefits by a month."
                            }
                        },
                        {
                            label: "Phased rollout: 30% → 70% → 100%",
                            text: "Scale in three waves over 6 weeks with learning cycles between each phase.",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: -7,
                                satisfaction: 9,
                                resolution: 7,
                                enterprise: 10,
                                team: 12,
                                leadership: 12
                            },
                            feedback: {
                                type: "success",
                                title: "Learning while scaling",
                                content: "Each wave revealed insights that improved the next. Wave 1 showed tier boundary issues—you refined them. Wave 2 revealed peak-hour bottlenecks—you added flex capacity. Final rollout smooth and confident."
                            }
                        },
                        {
                            label: "Voluntary adoption",
                            text: "Make it available but optional. Let teams adopt when ready, share learnings organically.",
                            outcome: "partial",
                            decisionQuality: "partial",
                            impact: {
                                responseTime: -2,
                                satisfaction: 4,
                                resolution: 2,
                                enterprise: 3,
                                team: 6,
                                leadership: -5
                            },
                            feedback: {
                                type: "warning",
                                title: "Slow, inconsistent adoption",
                                content: "Only 45% adopted in 6 weeks. Customers experienced inconsistent service. Leadership frustrated by slow progress. Eventually had to mandate anyway—should have done structured rollout from start."
                            }
                        }
                    ];
                }
            },
            {
                week: 5,
                problem: "The process is working, but the team escalates every decision to you. When you're out, decision-making stops. How do you create sustainable governance?",
                getBranchedOptions: function(branchingState) {
                    const baseOptions = [
                        {
                            label: "Document everything in detail",
                            text: "Create comprehensive manual with decision trees for every scenario to eliminate ambiguity.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 2,
                                satisfaction: -4,
                                resolution: -3,
                                enterprise: -5,
                                team: -8,
                                leadership: -6
                            },
                            feedback: {
                                type: "danger",
                                title: "Rigidity defeats adaptiveness",
                                content: "300-page manual created but new edge cases emerged constantly. Teams followed rules mechanically even when context suggested otherwise. Process improvement stopped—'it's documented, we can't change it.'"
                            }
                        },
                        {
                            label: "Distributed authority with guardrails",
                            text: "Define what teams can decide locally, what needs approval, and how learning is captured.",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: -4,
                                satisfaction: 8,
                                resolution: 6,
                                enterprise: 8,
                                team: 15,
                                leadership: 12
                            },
                            feedback: {
                                type: "success",
                                title: "Self-adapting system created",
                                content: "Teams now make 85% of decisions locally. Weekly huddles capture learnings. Monthly reviews surface patterns. Process continuously improves without you being the bottleneck. When you're out, work continues."
                            }
                        },
                        {
                            label: "Create a Process Council",
                            text: "8-person rotating committee reviews all changes and makes adaptation decisions.",
                            outcome: "partial",
                            decisionQuality: "partial",
                            impact: {
                                responseTime: -1,
                                satisfaction: 3,
                                resolution: 2,
                                enterprise: 3,
                                team: 5,
                                leadership: 4
                            },
                            feedback: {
                                type: "warning",
                                title: "Better, but slow",
                                content: "Council makes good strategic decisions but becomes a bottleneck for operational adjustments. Teams must wait for bi-weekly meetings. Good for policy, poor for real-time adaptation."
                            }
                        }
                    ];

                    if (branchingState === 'crisis') {
                        baseOptions[1].locked = true;
                        baseOptions[1].lockedReason = "Team trust is too low for distributed authority. They need more structure first.";
                    }

                    return baseOptions;
                }
            },
            {
                week: 6,
                problem: "Customer needs are evolving—they now want chat support, not just email/phone. How do you adapt your tiered process to new channels?",
                getBranchedOptions: function(branchingState) {
                    return [
                        {
                            label: "Add chat to all tiers immediately",
                            text: "Deploy chat capability across all service tiers at once to meet customer expectations.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 5,
                                satisfaction: -3,
                                resolution: -4,
                                enterprise: -6,
                                team: -10,
                                leadership: -7
                            },
                            feedback: {
                                type: "warning",
                                title: "Overextension without preparation",
                                content: "Agents struggled with chat volume while maintaining phone/email. Chat response times were poor. Team burnout increased. Should have tested chat in one tier first."
                            }
                        },
                        {
                            label: "Pilot chat in Tier 1 only",
                            text: "Test chat with Enterprise VIP customers first, learn, refine, then expand to other tiers.",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: -3,
                                satisfaction: 7,
                                resolution: 5,
                                enterprise: 12,
                                team: 6,
                                leadership: 8
                            },
                            feedback: {
                                type: "success",
                                title: "Incremental channel expansion",
                                content: "Tier 1 chat pilot revealed staffing needs and workflow adjustments. You refined the model before expanding to Tier 2/3. Enterprise clients love the responsiveness. Controlled, learning-based adaptation."
                            }
                        },
                        {
                            label: "Outsource chat to third party",
                            text: "Contract with chat support vendor to handle this channel while you focus on core process.",
                            outcome: "partial",
                            decisionQuality: "partial",
                            impact: {
                                responseTime: -2,
                                satisfaction: 2,
                                resolution: 1,
                                enterprise: -3,
                                team: 4,
                                leadership: 3
                            },
                            feedback: {
                                type: "warning",
                                title: "Speed but quality concerns",
                                content: "Chat launched quickly but vendor doesn't understand your tiering model. Enterprise clients get inconsistent service. You're now managing two processes—internal and vendor. Integration issues persist."
                            }
                        }
                    ];
                }
            },
            {
                week: 7,
                problem: "Leadership wants to cut costs by 15% due to budget pressures. Your improved process costs 8% more than the old one. How do you respond?",
                getBranchedOptions: function(branchingState) {
                    return [
                        {
                            label: "Reduce Tier 1 team size",
                            text: "Cut the premium service team to reduce costs while maintaining other tiers.",
                            outcome: "poor",
                            decisionQuality: "poor",
                            impact: {
                                responseTime: 6,
                                satisfaction: -8,
                                resolution: -5,
                                enterprise: -20,
                                team: -6,
                                leadership: -10
                            },
                            feedback: {
                                type: "danger",
                                title: "Destroyed your gains",
                                content: "Enterprise response times spiked back to 24+ hours. Three major clients switched to competitors. Revenue loss far exceeded cost savings. Leadership now sees the process redesign as failed."
                            }
                        },
                        {
                            label: "Show cost vs. value analysis",
                            text: "Present data on revenue retention, customer lifetime value, and efficiency gains from the new process.",
                            outcome: "excellent",
                            decisionQuality: "excellent",
                            impact: {
                                responseTime: 0,
                                satisfaction: 3,
                                resolution: 2,
                                enterprise: 5,
                                team: 8,
                                leadership: 15
                            },
                            feedback: {
                                type: "success",
                                title: "Evidence-based advocacy",
                                content: "Your data showed 3 at-risk enterprise accounts renewed (value: $2.4M), churn decreased 12%, and NPS improved 18 points. Leadership recognized 8% cost increase delivers 25% value increase. Budget approved."
                            }
                        },
                        {
                            label: "Automate Tier 3 with AI",
                            text: "Use AI chatbots for self-service tier to reduce costs while protecting premium tiers.",
                            outcome: "partial",
                            decisionQuality: "partial",
                            impact: {
                                responseTime: -1,
                                satisfaction: 2,
                                resolution: 3,
                                enterprise: 3,
                                team: 3,
                                leadership: 8
                            },
                            feedback: {
                                type: "success",
                                title: "Strategic automation",
                                content: "AI handles 40% of Tier 3 volume effectively, reducing costs 6%. Quality remains high because AI is well-suited for standardized queries. Good balance of efficiency and service quality."
                            }
                        }
                    ];
                }
            }
        ];

        // ===== CHART INITIALIZATION =====
        let metricsChart;

        function initChart() {
            const ctx = document.getElementById('metricsChart').getContext('2d');
            metricsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Baseline'],
                    datasets: [
                        {
                            label: 'Response Time (hrs)',
                            data: [33],
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Satisfaction (%)',
                            data: [83],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Resolution (%)',
                            data: [67],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        if (context.datasetIndex === 0) {
                                            label += context.parsed.y + ' hrs';
                                        } else {
                                            label += context.parsed.y + '%';
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Response Time (hours)'
                            },
                            min: 0,
                            max: 60
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Percentage (%)'
                            },
                            min: 0,
                            max: 100,
                            grid: {
                                drawOnChartArea: false,
                            }
                        }
                    }
                }
            });
        }

        // ===== BRANCHING LOGIC =====
        function updateBranchingState() {
            const recentDecisions = state.decisionPath.slice(-3);
            const poorCount = recentDecisions.filter(d => d === 'poor').length;
            const excellentCount = recentDecisions.filter(d => d === 'excellent').length;

            if (poorCount >= 2) {
                state.branchingState = 'crisis';
            } else if (poorCount >= 1 && excellentCount === 0) {
                state.branchingState = 'struggling';
            } else {
                state.branchingState = 'normal';
            }
        }

        function getBranchingNoticeHTML() {
            if (state.branchingState === 'crisis') {
                return '<div class="branching-notice">⚠️ <strong>Crisis Mode:</strong> Your previous poor decisions have limited your options. Some strategic approaches are no longer available.</div>';
            } else if (state.branchingState === 'struggling') {
                return '<div class="branching-notice warning">⚡ <strong>Under Pressure:</strong> Your recent choices have constrained your next moves. Careful decision-making is crucial.</div>';
            }
            return '';
        }

        // ===== UI UPDATE FUNCTIONS =====
        function updateMetricsDisplay() {
            document.getElementById('metricResponseTime').textContent = state.metrics.responseTime + 'hrs';
            document.getElementById('metricSatisfaction').textContent = state.metrics.satisfaction + '%';
            document.getElementById('metricResolution').textContent = state.metrics.resolution + '%';

            const rtChange = state.metrics.responseTime - 33;
            const satChange = state.metrics.satisfaction - 83;
            const resChange = state.metrics.resolution - 67;

            document.getElementById('changeResponseTime').textContent = 
                (rtChange >= 0 ? '↑ ' : '↓ ') + Math.abs(rtChange) + 'hrs from baseline';
            document.getElementById('changeResponseTime').className = 
                'metric-change ' + (rtChange >= 0 ? 'negative' : 'positive');

            document.getElementById('changeSatisfaction').textContent = 
                (satChange >= 0 ? '↑ ' : '↓ ') + Math.abs(satChange) + 'pts from baseline';
            document.getElementById('changeSatisfaction').className = 
                'metric-change ' + (satChange >= 0 ? 'positive' : 'negative');

            document.getElementById('changeResolution').textContent = 
                (resChange >= 0 ? '↑ ' : '↓ ') + Math.abs(resChange) + 'pts from baseline';
            document.getElementById('changeResolution').className = 
                'metric-change ' + (resChange >= 0 ? 'positive' : 'negative');
        }

        function updateStakeholders() {
            const stakeholders = ['enterprise', 'team', 'leadership'];
            const labels = {
                enterprise: ['Enterprise', 'Frustrated with delays', 'Somewhat satisfied', 'Very satisfied'],
                team: ['Support Team', 'Overwhelmed', 'Managing well', 'Engaged and capable'],
                leadership: ['Leadership', 'Concerned about costs', 'Cautiously optimistic', 'Confident in direction']
            };

            stakeholders.forEach(sh => {
                const value = state.stakeholders[sh];
                const fill = document.getElementById('sat' + sh.charAt(0).toUpperCase() + sh.slice(1));
                const status = document.getElementById('status' + sh.charAt(0).toUpperCase() + sh.slice(1));

                fill.style.width = value + '%';

                if (value >= 70) {
                    fill.className = 'satisfaction-fill high';
                    status.textContent = value + '% - ' + labels[sh][3];
                } else if (value >= 50) {
                    fill.className = 'satisfaction-fill medium';
                    status.textContent = value + '% - ' + labels[sh][2];
                } else {
                    fill.className = 'satisfaction-fill low';
                    status.textContent = value + '% - ' + labels[sh][1];
                }
            });
        }

        function updateChart() {
            const labels = state.metricsHistory.map((_, idx) => idx === 0 ? 'Baseline' : 'Week ' + idx);
            const responseData = state.metricsHistory.map(m => m.responseTime);
            const satisfactionData = state.metricsHistory.map(m => m.satisfaction);
            const resolutionData = state.metricsHistory.map(m => m.resolution);

            metricsChart.data.labels = labels;
            metricsChart.data.datasets[0].data = responseData;
            metricsChart.data.datasets[1].data = satisfactionData;
            metricsChart.data.datasets[2].data = resolutionData;
            metricsChart.update();
        }

        function updateHistory() {
            const container = document.getElementById('historyContainer');
            
            if (state.history.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No decisions made yet.</p>';
                return;
            }

            container.innerHTML = '';
            state.history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item ' + item.outcome;
                div.innerHTML = `
                    <div class="history-week">Week ${item.week}</div>
                    <div class="history-problem"><strong>Challenge:</strong> ${item.problem}</div>
                    <div class="history-action"><strong>Action:</strong> ${item.action}</div>
                    <div class="history-outcome"><strong>Outcome:</strong> ${item.outcomeText}</div>
                `;
                container.appendChild(div);
            });
        }

        // ===== MODAL FUNCTIONS =====
        function showDecisionPanel() {
            if (state.currentWeek > scenarios.length) {
                showCompletionModal();
                return;
            }

            const scenario = scenarios[state.currentWeek - 1];
            
            document.getElementById('panelTitle').textContent = 'Week ' + state.currentWeek + ' Decision';
            document.getElementById('panelWeek').textContent = 'Week ' + state.currentWeek + ' of 7';
            
            // Get problem text
            const problemText = scenario.problem;
            document.getElementById('problemText').textContent = problemText;

            // Show branching notice if applicable
            document.getElementById('branchingNotice').innerHTML = getBranchingNoticeHTML();

            // Get options (possibly branched)
            const options = scenario.getBranchedOptions ? 
                scenario.getBranchedOptions(state.branchingState) : 
                scenario.options;

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'option' + (option.locked ? ' locked' : '');
                div.innerHTML = `
                    <div class="option-label">Option ${index + 1}: ${option.label}</div>
                    <div class="option-text">${option.text}</div>
                    ${option.locked ? '<div class="option-locked-text">🔒 ' + option.lockedReason + '</div>' : ''}
                `;
                
                if (!option.locked) {
                    div.onclick = () => selectOption(option, scenario, index);
                }
                
                optionsContainer.appendChild(div);
            });

            document.getElementById('feedbackPanel').classList.remove('active');
            document.getElementById('continueBtn').disabled = true;
            document.getElementById('decisionPanel').classList.add('active');
            document.getElementById('mainContainer').classList.add('panel-open');
        }

        function selectOption(option, scenario, index) {
            // Disable all options
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.add('disabled');
            });

            // Highlight selected
            document.querySelectorAll('.option')[index].classList.add('selected');

            // Track decision quality
            state.decisionPath.push(option.decisionQuality);
            updateBranchingState();

            // Apply impacts
            state.metrics.responseTime += option.impact.responseTime;
            state.metrics.satisfaction += option.impact.satisfaction;
            state.metrics.resolution += option.impact.resolution;

            state.stakeholders.enterprise += option.impact.enterprise;
            state.stakeholders.team += option.impact.team;
            state.stakeholders.leadership += option.impact.leadership;

            // Clamp values
            state.metrics.responseTime = Math.max(15, Math.min(60, state.metrics.responseTime));
            state.metrics.satisfaction = Math.max(0, Math.min(100, state.metrics.satisfaction));
            state.metrics.resolution = Math.max(0, Math.min(100, state.metrics.resolution));

            state.stakeholders.enterprise = Math.max(0, Math.min(100, state.stakeholders.enterprise));
            state.stakeholders.team = Math.max(0, Math.min(100, state.stakeholders.team));
            state.stakeholders.leadership = Math.max(0, Math.min(100, state.stakeholders.leadership));

            // Record history
            state.history.push({
                week: state.currentWeek,
                problem: scenario.problem,
                action: option.label,
                outcomeText: option.feedback.content,
                outcome: option.feedback.type
            });

            // Record metrics history
            state.metricsHistory.push({
                week: state.currentWeek,
                responseTime: state.metrics.responseTime,
                satisfaction: state.metrics.satisfaction,
                resolution: state.metrics.resolution
            });

            // Show feedback
            const feedback = document.getElementById('feedbackPanel');
            feedback.className = 'feedback-panel active ' + option.feedback.type;
            document.getElementById('feedbackTitle').textContent = option.feedback.title;
            document.getElementById('feedbackContent').textContent = option.feedback.content;

            // Enable continue
            document.getElementById('continueBtn').disabled = false;
        }

        function continueToNextWeek() {
            state.currentWeek++;
            document.getElementById('weekNumber').textContent = 'Week ' + state.currentWeek;
            
            updateMetricsDisplay();
            updateStakeholders();
            updateChart();
            updateHistory();

            document.getElementById('decisionPanel').classList.remove('active');
            document.getElementById('mainContainer').classList.remove('panel-open');

            if (state.currentWeek <= scenarios.length) {
                setTimeout(showDecisionPanel, 800);
            } else {
                showCompletionModal();
            }
        }

        function showCompletionModal() {
            const avgStakeholder = Math.round(
                (state.stakeholders.enterprise + state.stakeholders.team + state.stakeholders.leadership) / 3
            );

            let performance = 'Good';
            let performanceClass = 'good';
            
            if (state.metrics.satisfaction >= 85 && avgStakeholder >= 75) {
                performance = 'Excellent Performance';
                performanceClass = 'excellent';
            } else if (state.metrics.satisfaction < 70 || avgStakeholder < 50) {
                performance = 'Needs Improvement';
                performanceClass = 'needs-improvement';
            }

            document.getElementById('performanceBadge').textContent = performance;
            document.getElementById('performanceBadge').className = 'performance-badge ' + performanceClass;
            
            document.getElementById('finalResponseTime').textContent = state.metrics.responseTime + ' hrs';
            document.getElementById('finalSatisfaction').textContent = state.metrics.satisfaction + '%';
            document.getElementById('finalResolution').textContent = state.metrics.resolution + '%';
            document.getElementById('finalStakeholder').textContent = avgStakeholder + '%';
            
            document.getElementById('keyInsightText').textContent = getKeyInsight();

            document.getElementById('completionModal').classList.add('active');
        }

        function closeCompletionModal() {
            document.getElementById('completionModal').classList.remove('active');
        }

        function getKeyInsight() {
            const goodDecisions = state.decisionPath.filter(d => d === 'excellent').length;
            
            if (goodDecisions >= 5) {
                return 'You consistently chose adaptive approaches, treating process challenges systemically rather than symptomatically. Your decisions showed strong systems thinking and a learning-oriented mindset.';
            } else if (goodDecisions >= 3) {
                return 'You made some strong adaptive decisions but occasionally reverted to quick fixes. Continue developing systems thinking—focus on addressing root causes rather than symptoms.';
            } else {
                return 'Many decisions focused on symptoms rather than root causes. Adaptive challenges require rethinking process design, not just optimization. Consider how your choices create or constrain future options.';
            }
        }

        // ===== EVENT LISTENERS =====
        document.getElementById('continueBtn').addEventListener('click', continueToNextWeek);

        // ===== INITIALIZATION =====
        initChart();
        updateMetricsDisplay();
        updateStakeholders();
        updateHistory();

        // Auto-start first decision
        setTimeout(showDecisionPanel, 1000);
    </script>
</body>
</html>