<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stress Response Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --AIMblue: #4353A3;
            --darkBlue: #38416D;
            --teal: #5DC8B9;
            --cream: #F1EEDE;
            --grey: #e7e9ec;
            --rust: #AF4510;
            --navy: #12195C;
            --white: #ffffff;
            --lightBlue: #AEBAE4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "IBM Plex Sans", sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: var(--darkBlue);
            font-size: 32px;
            margin-bottom: 15px;
        }

        .intro-text {
            color: var(--darkBlue);
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .intro-highlight {
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid var(--AIMblue);
            margin-top: 15px;
        }

        .columns-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .column {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            animation: fadeIn 0.5s ease-in;
        }

        .column-title {
            color: var(--darkBlue);
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--AIMblue);
        }

        .item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .item:hover {
            border-color: var(--lightBlue);
            background: #f7fafc;
        }

        .item.selected {
            border-color: var(--teal);
            background: #f0fdf9;
            box-shadow: 0 4px 12px rgba(93, 200, 185, 0.2);
        }

        .item-text {
            flex: 1;
            color: #2d3748;
            font-size: 15px;
            line-height: 1.5;
        }

        .add-btn {
            background: var(--AIMblue);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(67, 83, 163, 0.4);
        }

        .item.selected .add-btn {
            background: var(--teal);
            transform: rotate(45deg);
        }

        .item.selected .add-btn:hover {
            transform: rotate(45deg) scale(1.1);
        }

        .selected-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease-in;
        }

        .selected-title {
            color: var(--darkBlue);
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .selected-count {
            color: #718096;
            font-size: 14px;
            margin-bottom: 25px;
        }

        .selected-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .selected-item {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--teal);
            color: #2d3748;
            font-size: 14px;
            line-height: 1.5;
        }

        .category-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--AIMblue);
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a0aec0;
        }

        .empty-state-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .download-btn {
            background: var(--AIMblue);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .download-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 83, 163, 0.3);
        }

        .download-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .download-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        /* Success Modal */
        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-in;
        }

        .success-modal.active {
            display: flex;
        }

        .success-content {
            background: white;
            border-radius: 12px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: var(--teal);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            animation: scaleIn 0.5s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }

        .success-icon svg {
            width: 50px;
            height: 50px;
            stroke: white;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        .success-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--darkBlue);
            margin-bottom: 10px;
        }

        .success-message {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .success-btn {
            background: var(--teal);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .success-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(93, 200, 185, 0.3);
        }

        @media (max-width: 1200px) {
            .columns-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 25px;
            }

            h1 {
                font-size: 24px;
            }

            .column {
                padding: 20px;
            }

            .selected-section {
                padding: 25px;
            }

            .selected-items-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- <h1>The Stress Response</h1>
            <p class="intro-text">
                While you may not be able to name the trigger, you can know you are being triggered by your unique body reactions to stress and tension. To do this, it is crucial to build your body awareness under times of stress.
            </p> -->
            <div class="intro-highlight">
                <strong>To help you recognise them, here is a list of common reactions under stress.</strong>
                <br><br>
                Click the <strong>+</strong> button next to items that are significant to you to build your personalized stress response profile.
            </div>
        </div>

        <div class="columns-container">
            <!-- Body Sensations Column -->
            <div class="column">
                <h2 class="column-title">Body Sensations</h2>
                <div id="bodySensations"></div>
            </div>

            <!-- Stress Thoughts Column -->
            <div class="column">
                <h2 class="column-title">Stress Thoughts</h2>
                <div id="stressThoughts"></div>
            </div>

            <!-- Impulses and Urges Column -->
            <div class="column">
                <h2 class="column-title">Impulses and Urges</h2>
                <div id="impulses"></div>
            </div>
        </div>

        <div class="selected-section">
            <h2 class="selected-title">My Stress Response Profile</h2>
            <p class="selected-count" id="selectedCount">0 items selected</p>
            
            <div id="selectedItemsContainer">
                <div class="empty-state">
                    <div class="empty-state-icon"></div>
                    <p>Select items from the lists above to build your personalized stress response profile.</p>
                </div>
            </div>

            <button class="download-btn" id="downloadBtn" disabled>Download My Stress Response Profile (PDF)</button>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="success-modal" id="successModal">
        <div class="success-content">
            <div class="success-icon">
                <svg viewBox="0 0 52 52">
                    <polyline points="14 27 22 35 38 19"/>
                </svg>
            </div>
            <h3 class="success-title">Download Successful!</h3>
            <p class="success-message">
                Your personalized stress response profile has been saved as a PDF.
            </p>
            <button class="success-btn" onclick="closeSuccessModal()">Close</button>
        </div>
    </div>

    <script>
        // Data
        const bodySensations = [
            "Tight chest, shallow breathing, holding breath",
            "Jaw clenched, teeth grinding, tension in neck/shoulders",
            "Racing heart, sweaty palms, flushed face",
            '"Buzzing" or jittery energy, restless legs, fidgeting',
            'Stomach drop, nausea, "knots," sudden hunger or no appetite',
            "Lump in throat, dry mouth, shaky voice",
            "Head pressure, headache, narrowed vision, tunnel focus",
            "Fatigue spike, heaviness, feeling frozen or sluggish"
        ];

        const stressThoughts = [
            '"This can\'t go wrong." / "I\'m going to look incompetent."',
            '"They don\'t respect me." / "I have to prove myself."',
            '"If I don\'t control this, it\'ll fall apart."',
            '"We need the right answer before we move."',
            '"This is urgent - do something now."',
            '"I can\'t trust anyone to do it properly."',
            '"I should keep the peace." / "Don\'t upset them."',
            '"I\'m failing." / "I\'m behind." / "I\'m trapped."'
        ];

        const impulses = [
            "Control: take over, micromanage, tighten rules, redo work yourself",
            "Defend: interrupt, argue, justify, explain excessively, blame-shift",
            'Avoid/withdraw: go quiet, delay decisions, cancel the conversation, "hide" in tasks',
            "Appease: say yes too fast, over-promise, soften boundaries, seek reassurance",
            "Rush: fire off messages, demand instant updates, make snap decisions",
            'People-judge: label others as the problem, become cynical, "prove them wrong"',
            "Overwork: stay late, skip breaks, push through exhaustion to regain control",
            "Detach: become overly cold/clinical, shut down emotion, stop listening"
        ];

        // Track selected items
        let selectedItems = {
            bodySensations: new Set(),
            stressThoughts: new Set(),
            impulses: new Set()
        };

        // Render items
        function renderColumn(items, containerId, category) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map((item, index) => `
                <div class="item" data-category="${category}" data-index="${index}" onclick="toggleItem('${category}', ${index})">
                    <div class="item-text">${item}</div>
                    <button class="add-btn">+</button>
                </div>
            `).join('');
        }

        // Toggle item selection
        function toggleItem(category, index) {
            if (selectedItems[category].has(index)) {
                selectedItems[category].delete(index);
            } else {
                selectedItems[category].add(index);
            }
            updateUI();
        }

        // Update UI
        function updateUI() {
            // Update item styling
            document.querySelectorAll('.item').forEach(item => {
                const category = item.dataset.category;
                const index = parseInt(item.dataset.index);
                if (selectedItems[category].has(index)) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });

            // Update selected items display
            updateSelectedItemsDisplay();

            // Update download button
            const totalSelected = [...Object.values(selectedItems)].reduce((sum, set) => sum + set.size, 0);
            document.getElementById('downloadBtn').disabled = totalSelected === 0;
        }

        // Update selected items display
        function updateSelectedItemsDisplay() {
            const container = document.getElementById('selectedItemsContainer');
            const totalSelected = [...Object.values(selectedItems)].reduce((sum, set) => sum + set.size, 0);
            
            document.getElementById('selectedCount').textContent = `${totalSelected} item${totalSelected !== 1 ? 's' : ''} selected`;

            if (totalSelected === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“‹</div>
                        <p>Select items from the lists above to build your personalized stress response profile.</p>
                    </div>
                `;
                return;
            }

            let html = '<div class="selected-items-grid">';
            
            const categories = {
                bodySensations: { title: 'Body Sensations', items: bodySensations },
                stressThoughts: { title: 'Stress Thoughts', items: stressThoughts },
                impulses: { title: 'Impulses & Urges', items: impulses }
            };

            Object.entries(categories).forEach(([key, data]) => {
                selectedItems[key].forEach(index => {
                    html += `
                        <div class="selected-item">
                            <div class="category-label">${data.title}</div>
                            ${data.items[index]}
                        </div>
                    `;
                });
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // Download PDF
        document.getElementById('downloadBtn').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let yPosition = 20;
            const leftMargin = 20;
            const pageWidth = doc.internal.pageSize.getWidth();
            const maxWidth = pageWidth - 40;

            // Title
            doc.setFontSize(20);
            doc.setFont(undefined, 'bold');
            doc.text('My Stress Response Profile', leftMargin, yPosition);
            yPosition += 10;

            // Date
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(100);
            const today = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            doc.text(today, leftMargin, yPosition);
            doc.setTextColor(0);
            yPosition += 15;

            // Intro
            doc.setFontSize(10);
            doc.setFont(undefined, 'italic');
            const intro = "These are the stress responses I've identified as most significant to me:";
            const introLines = doc.splitTextToSize(intro, maxWidth);
            doc.text(introLines, leftMargin, yPosition);
            yPosition += (introLines.length * 5) + 10;

            // Function to add section
            function addSection(title, items, data) {
                if (items.size === 0) return;

                // Check if we need a new page
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }

                // Section title
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text(title, leftMargin, yPosition);
                yPosition += 8;

                // Items
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                
                items.forEach(index => {
                    const itemText = data[index];
                    const lines = doc.splitTextToSize(`â€¢ ${itemText}`, maxWidth - 5);
                    
                    lines.forEach(line => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        doc.text(line, leftMargin + 5, yPosition);
                        yPosition += 5;
                    });
                    yPosition += 2;
                });

                yPosition += 8;
            }

            // Add all sections
            addSection('Body Sensations', selectedItems.bodySensations, bodySensations);
            addSection('Stress Thoughts', selectedItems.stressThoughts, stressThoughts);
            addSection('Impulses and Urges', selectedItems.impulses, impulses);

            // Save the PDF
            doc.save(`stress-response-profile-${new Date().toISOString().split('T')[0]}.pdf`);

            // Show success modal
            showSuccessModal();
        });

        function showSuccessModal() {
            document.getElementById('successModal').classList.add('active');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        // Close modal when clicking outside
        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSuccessModal();
            }
        });

        // Initialize
        renderColumn(bodySensations, 'bodySensations', 'bodySensations');
        renderColumn(stressThoughts, 'stressThoughts', 'stressThoughts');
        renderColumn(impulses, 'impulses', 'impulses');
    </script>
</body>
</html>